<%= form_for(@emergency) do |f| %>
  <% if @emergency.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@emergency.errors.count, "error") %> prohibited this emergency from being saved:</h2>

      <ul>
      <% @emergency.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :lugar %><br>
    <%= f.text_field :lugar %>
  </div>
  <div class="field">
    <%= f.label :denunciante %><br>
    <%= f.text_field :denunciante %>
  </div>
  <div class="field">
    <%= f.label :telefono_denunciante %><br>
    <%= f.text_field :telefono_denunciante %>
  </div>
  <div class="field">
    <%= f.label :numero_caso %><br>
    <%= f.text_field :numero_caso %>
  </div>
  <div class="field">
    <%= f.label :sigla_vehiculo %><br>
    <%= f.text_field :sigla_vehiculo %>
  </div>
  <div class="field">
    <%= f.label :hora_salida %><br>
    <%= f.datetime_select :hora_salida %>
  </div>
  <div class="field">
    <%= f.label :observacion %><br>
    <%= f.text_area :observacion %>
  </div>
  <div class="field">
    <%= f.label :user_id, "Despachador" %><br>
    <%= f.select :user_id, options_from_collection_for_select(User.all,:id,:nombre) %>
  </div>
  <div class="field">
    <%= f.label :referencia_lugar %><br>
    <%= f.text_area :referencia_lugar %>
  </div>
  <div class="field">
    <%= f.label :tipo %><br>
    <%= f.text_field :tipo %>
  </div>
  <div class="field">
    <%= f.hidden_field :latitude %>
  </div>
  <div class="field">
   <%= f.hidden_field :longitude %>
  </div>
  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>

<div id="map" style="width:500px; height:500px"></div>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
  <script>
  function initialize() {
    var $latitude = document.getElementById('emergency_latitude');
    var $longitude = document.getElementById('emergency_longitude');
    var latitude = -17.40049275908006
    var longitude = -66.1427843109314;
    var zoom = 15;
    
    var LatLng = new google.maps.LatLng(latitude, longitude);
    
    var mapOptions = {
      zoom: zoom,
      center: LatLng,
      panControl: false,
      zoomControl: false,
      scaleControl: true,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    } 
    
    var map = new google.maps.Map(document.getElementById('map'),mapOptions);
      
    
    var marker = new google.maps.Marker({
      position: LatLng,
      map: map,
      title: 'Drag Me!',
      draggable: true
    });
    
    google.maps.event.addListener(marker, 'dragend', function(marker){
      var latLng = marker.latLng;
      $latitude.value = latLng.lat();
      $longitude.value = latLng.lng();
    });
    
    
  }
  initialize();
  </script>