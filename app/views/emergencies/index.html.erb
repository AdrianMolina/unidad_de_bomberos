<br>
<br>
<div class="row">
  <div class="col-md-6">
    <div class="page-header">
         <h1 id="forms">Emergencias</h1>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-6">
    <h4>Buscar por numero de caso, direccion o  denunciante</h4>
    <br>
    <%= form_tag emergencies_path, :method => 'get' do %>
    <%= text_field_tag :search, params[:search] %>
    Fecha inicio: <%= text_field_tag :date, params[:date], :onchange => 'llenar()' %>
    Fecha fin: <%= text_field_tag :fecha_fin, params[:fecha_fin] %>
          <%= submit_tag "Buscar", :name => nil, :class => 'btn btn-primary btn ' %> 
    <% end %>
  </div>
</div>
<br>
<div class="col-md-12">
  <div class="well">
    <div class="row">
      <div class="col-md-12">
        <div class="table-responsive">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Numero caso</th>
              <th>Direccion</th>
              <th>Denunciante</th>
              <th>Observacion</th>
              <th>Fecha de emergencia</th>
              <th>Tipo</th>
            </tr>
          </thead>

          <tbody>
            <% @emergencies.each do |emergency| %>
              <tr>
                <td style= 'cursor:pointer' onclick=<%="document.location.href='/emergencies/"+emergency.id.to_s+"'"%>><%= emergency.numero_caso %></td>
                <td style= 'cursor:pointer' onclick=<%="document.location.href='/emergencies/"+emergency.id.to_s+"'"%>><%= emergency.lugar %></td>
                <td style= 'cursor:pointer' onclick=<%="document.location.href='/emergencies/"+emergency.id.to_s+"'"%>><%= emergency.denunciante %></td>
                <td style= 'cursor:pointer' onclick=<%="document.location.href='/emergencies/"+emergency.id.to_s+"'"%>><%= emergency.observacion %></td>
                <td style= 'cursor:pointer' onclick=<%="document.location.href='/emergencies/"+emergency.id.to_s+"'"%>><%= emergency.hora_salida.strftime("%Y/%m/%e %I:%M") %></td>
                <td style= 'cursor:pointer' onclick=<%="document.location.href='/emergencies/"+emergency.id.to_s+"'"%>><%= emergency.tipo %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
        </div>
      </div>
    </div>
  </div>
  <a data-no-turbolink="true" href="<%=new_emergency_path%>" class="btn btn-danger btn-sm active" role="button">Registrar Emergencia</a>
  <BR>
  
</div>
  <script type="text/javascript">
  
 jQuery('#date').datetimepicker({
  format:'d/m/Y',
  onShow:function( ct ){
   this.setOptions({
    maxDate:jQuery('#fecha_fin').val()?jQuery('#fecha_fin').val():false
   })
  },
  timepicker:false
 });
 jQuery('#fecha_fin').datetimepicker({
  format:'d/m/Y',
  onShow:function( ct ){
   this.setOptions({
    minDate:jQuery('#date').val()?jQuery('#date').val():false
   })
  },
  timepicker:false
 });  
</script>
<script>
function llenar() {
    var $fecha_inicio = document.getElementById('date');
    var $fecha_fin = document.getElementById('fecha_fin');
    if ($fecha_fin.value ==""){
      $fecha_fin.value = $fecha_inicio.value;
    }
}
</script>